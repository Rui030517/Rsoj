# 代码沙箱微服务


### 要执行一份用户传进来得代码核心思路是什么：
#### 用程序代替人工，用程序来操作命令行去执行编译代码。类如：
      
---javac -encoding UTF-8 .\Main.java        
---java -cp . Main 1 2     

了解java进程管理类 ：Process

#### 实现步骤：
1. 把用户的代码保存为文件
    1. 引用HuTool工具类：简化开发
2. 编译代码，得到.class文件
3. 执行代码得到输出结果
4. 收集整理输出结果
5. 文件清理
6. 一些错误处理，提升程序健壮性


##### 超时控制：
   创建一个子线程监控process，超时自动中断process实现

#### 限制支援的分配
   不能让每个进程的执行占用的JVM最大堆内存空间和系统的一致，实践上应该小一点（256MB）
   JVM 参数：-Xmx256m
   (想要更严格的内存限制，要在系统层面去限制，如果是Linux系统，可以使用cgroup来实现对某个进程的CPU，内存支援的分配)
   
#### 禁用词黑白名单
   WordTree 字典树存储关键词黑名单，校验用户代码安全性
   （缺点：无法遍历所有的黑名单；不同的编程语言对应的关键词不一样）
   
#### 限制用户的操作权限
   java安全管理器（Security Manage）是java提供的保护JVM，java的安全机制，实现严格的资源和操作限制
   （优点：权限控制灵活，实现简单）
   （缺点：如果要做比较严格的权限控制，需要自己去判断哪些文件，哪些包名需要允许读写，粒度太细难以精细化控制）
   （缺点：还是程序上的控制，没到系统的层面）
   
#### 运行环境隔离
   系统层面上，把用户程序封装到沙箱里，和我们的电脑或服务器隔离开，Docker容器技术可以实现。
   

### 代码沙箱Docker实现
   DockerClient：和Docker守护进程交互的，最方便的SDK，高层封装，对DockerHttpClient在进行了一层封装（可以理解为Mybatis）
   